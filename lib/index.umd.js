(function(vt,ut){typeof exports=="object"&&typeof module<"u"?ut(exports):typeof define=="function"&&define.amd?define(["exports"],ut):(vt=typeof globalThis<"u"?globalThis:vt||self,ut(vt.gmecdh={}))})(this,function(vt){"use strict";var ut=function(n,i){return ut=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,f){s.__proto__=f}||function(s,f){for(var h in f)Object.prototype.hasOwnProperty.call(f,h)&&(s[h]=f[h])},ut(n,i)};function Te(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");ut(n,i);function s(){this.constructor=n}n.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}var Fe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},z={},Be={get exports(){return z},set exports(n){z=n}};(function(n,i){(function(){var s,f=0xdeadbeefcafe,h=(f&16777215)==15715070;function o(t,e,r){t!=null&&(typeof t=="number"?this.fromNumber(t,e,r):e==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,e))}function a(){return new o(null)}function y(t,e,r,u,c,p){for(;--p>=0;){var v=e*this[t++]+r[u]+c;c=Math.floor(v/67108864),r[u++]=v&67108863}return c}function l(t,e,r,u,c,p){for(var v=e&32767,b=e>>15;--p>=0;){var M=this[t]&32767,R=this[t++]>>15,$=b*M+R*v;M=v*M+(($&32767)<<15)+r[u]+(c&1073741823),c=(M>>>30)+($>>>15)+b*R+(c>>>30),r[u++]=M&1073741823}return c}function w(t,e,r,u,c,p){for(var v=e&16383,b=e>>14;--p>=0;){var M=this[t]&16383,R=this[t++]>>14,$=b*M+R*v;M=v*M+(($&16383)<<14)+r[u]+c,c=(M>>28)+($>>14)+b*R,r[u++]=M&268435455}return c}var g=typeof navigator<"u";g&&h&&navigator.appName=="Microsoft Internet Explorer"?(o.prototype.am=l,s=30):g&&h&&navigator.appName!="Netscape"?(o.prototype.am=y,s=26):(o.prototype.am=w,s=28),o.prototype.DB=s,o.prototype.DM=(1<<s)-1,o.prototype.DV=1<<s;var x=52;o.prototype.FV=Math.pow(2,x),o.prototype.F1=x-s,o.prototype.F2=2*s-x;var m="0123456789abcdefghijklmnopqrstuvwxyz",T=new Array,d,F;for(d="0".charCodeAt(0),F=0;F<=9;++F)T[d++]=F;for(d="a".charCodeAt(0),F=10;F<36;++F)T[d++]=F;for(d="A".charCodeAt(0),F=10;F<36;++F)T[d++]=F;function E(t){return m.charAt(t)}function D(t,e){var r=T[t.charCodeAt(e)];return r??-1}function q(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function _(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0}function O(t){var e=a();return e.fromInt(t),e}function V(t,e){var r;if(e==16)r=4;else if(e==8)r=3;else if(e==256)r=8;else if(e==2)r=1;else if(e==32)r=5;else if(e==4)r=2;else{this.fromRadix(t,e);return}this.t=0,this.s=0;for(var u=t.length,c=!1,p=0;--u>=0;){var v=r==8?t[u]&255:D(t,u);if(v<0){t.charAt(u)=="-"&&(c=!0);continue}c=!1,p==0?this[this.t++]=v:p+r>this.DB?(this[this.t-1]|=(v&(1<<this.DB-p)-1)<<p,this[this.t++]=v>>this.DB-p):this[this.t-1]|=v<<p,p+=r,p>=this.DB&&(p-=this.DB)}r==8&&t[0]&128&&(this.s=-1,p>0&&(this[this.t-1]|=(1<<this.DB-p)-1<<p)),this.clamp(),c&&o.ZERO.subTo(this,this)}function Z(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function N(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(t==16)e=4;else if(t==8)e=3;else if(t==2)e=1;else if(t==32)e=5;else if(t==4)e=2;else return this.toRadix(t);var r=(1<<e)-1,u,c=!1,p="",v=this.t,b=this.DB-v*this.DB%e;if(v-- >0)for(b<this.DB&&(u=this[v]>>b)>0&&(c=!0,p=E(u));v>=0;)b<e?(u=(this[v]&(1<<b)-1)<<e-b,u|=this[--v]>>(b+=this.DB-e)):(u=this[v]>>(b-=e)&r,b<=0&&(b+=this.DB,--v)),u>0&&(c=!0),c&&(p+=E(u));return c?p:"0"}function k(){var t=a();return o.ZERO.subTo(this,t),t}function tt(){return this.s<0?this.negate():this}function ft(t){var e=this.s-t.s;if(e!=0)return e;var r=this.t;if(e=r-t.t,e!=0)return this.s<0?-e:e;for(;--r>=0;)if((e=this[r]-t[r])!=0)return e;return 0}function I(t){var e=1,r;return(r=t>>>16)!=0&&(t=r,e+=16),(r=t>>8)!=0&&(t=r,e+=8),(r=t>>4)!=0&&(t=r,e+=4),(r=t>>2)!=0&&(t=r,e+=2),(r=t>>1)!=0&&(t=r,e+=1),e}function Bt(){return this.t<=0?0:this.DB*(this.t-1)+I(this[this.t-1]^this.s&this.DM)}function lt(t,e){var r;for(r=this.t-1;r>=0;--r)e[r+t]=this[r];for(r=t-1;r>=0;--r)e[r]=0;e.t=this.t+t,e.s=this.s}function St(t,e){for(var r=t;r<this.t;++r)e[r-t]=this[r];e.t=Math.max(this.t-t,0),e.s=this.s}function Pt(t,e){var r=t%this.DB,u=this.DB-r,c=(1<<u)-1,p=Math.floor(t/this.DB),v=this.s<<r&this.DM,b;for(b=this.t-1;b>=0;--b)e[b+p+1]=this[b]>>u|v,v=(this[b]&c)<<r;for(b=p-1;b>=0;--b)e[b]=0;e[p]=v,e.t=this.t+p+1,e.s=this.s,e.clamp()}function Ii(t,e){e.s=this.s;var r=Math.floor(t/this.DB);if(r>=this.t){e.t=0;return}var u=t%this.DB,c=this.DB-u,p=(1<<u)-1;e[0]=this[r]>>u;for(var v=r+1;v<this.t;++v)e[v-r-1]|=(this[v]&p)<<c,e[v-r]=this[v]>>u;u>0&&(e[this.t-r-1]|=(this.s&p)<<c),e.t=this.t-r,e.clamp()}function Ai(t,e){for(var r=0,u=0,c=Math.min(t.t,this.t);r<c;)u+=this[r]-t[r],e[r++]=u&this.DM,u>>=this.DB;if(t.t<this.t){for(u-=t.s;r<this.t;)u+=this[r],e[r++]=u&this.DM,u>>=this.DB;u+=this.s}else{for(u+=this.s;r<t.t;)u-=t[r],e[r++]=u&this.DM,u>>=this.DB;u-=t.s}e.s=u<0?-1:0,u<-1?e[r++]=this.DV+u:u>0&&(e[r++]=u),e.t=r,e.clamp()}function Ei(t,e){var r=this.abs(),u=t.abs(),c=r.t;for(e.t=c+u.t;--c>=0;)e[c]=0;for(c=0;c<u.t;++c)e[c+r.t]=r.am(0,u[c],e,c,0,r.t);e.s=0,e.clamp(),this.s!=t.s&&o.ZERO.subTo(e,e)}function Di(t){for(var e=this.abs(),r=t.t=2*e.t;--r>=0;)t[r]=0;for(r=0;r<e.t-1;++r){var u=e.am(r,e[r],t,2*r,0,1);(t[r+e.t]+=e.am(r+1,2*e[r],t,2*r+1,u,e.t-r-1))>=e.DV&&(t[r+e.t]-=e.DV,t[r+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(r,e[r],t,2*r,0,1)),t.s=0,t.clamp()}function qi(t,e,r){var u=t.abs();if(!(u.t<=0)){var c=this.abs();if(c.t<u.t){e!=null&&e.fromInt(0),r!=null&&this.copyTo(r);return}r==null&&(r=a());var p=a(),v=this.s,b=t.s,M=this.DB-I(u[u.t-1]);M>0?(u.lShiftTo(M,p),c.lShiftTo(M,r)):(u.copyTo(p),c.copyTo(r));var R=p.t,$=p[R-1];if($!=0){var U=$*(1<<this.F1)+(R>1?p[R-2]>>this.F2:0),et=this.FV/U,Ct=(1<<this.F1)/U,Q=1<<this.F2,W=r.t,Rt=W-R,ht=e??a();for(p.dlShiftTo(Rt,ht),r.compareTo(ht)>=0&&(r[r.t++]=1,r.subTo(ht,r)),o.ONE.dlShiftTo(R,ht),ht.subTo(p,p);p.t<R;)p[p.t++]=0;for(;--Rt>=0;){var Lt=r[--W]==$?this.DM:Math.floor(r[W]*et+(r[W-1]+Q)*Ct);if((r[W]+=p.am(0,Lt,r,Rt,0,R))<Lt)for(p.dlShiftTo(Rt,ht),r.subTo(ht,r);r[W]<--Lt;)r.subTo(ht,r)}e!=null&&(r.drShiftTo(R,e),v!=b&&o.ZERO.subTo(e,e)),r.t=R,r.clamp(),M>0&&r.rShiftTo(M,r),v<0&&o.ZERO.subTo(r,r)}}}function Mi(t){var e=a();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(o.ZERO)>0&&t.subTo(e,e),e}function pt(t){this.m=t}function Oi(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function Ci(t){return t}function Ri(t){t.divRemTo(this.m,null,t)}function _i(t,e,r){t.multiplyTo(e,r),this.reduce(r)}function Hi(t,e){t.squareTo(e),this.reduce(e)}pt.prototype.convert=Oi,pt.prototype.revert=Ci,pt.prototype.reduce=Ri,pt.prototype.mulTo=_i,pt.prototype.sqrTo=Hi;function Ni(){if(this.t<1)return 0;var t=this[0];if(!(t&1))return 0;var e=t&3;return e=e*(2-(t&15)*e)&15,e=e*(2-(t&255)*e)&255,e=e*(2-((t&65535)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function xt(t){this.m=t,this.mp=t.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function Pi(t){var e=a();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(o.ZERO)>0&&this.m.subTo(e,e),e}function Vi(t){var e=a();return t.copyTo(e),this.reduce(e),e}function ji(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var r=t[e]&32767,u=r*this.mpl+((r*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(r=e+this.m.t,t[r]+=this.m.am(0,u,t,e,0,this.m.t);t[r]>=t.DV;)t[r]-=t.DV,t[++r]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function Zi(t,e){t.squareTo(e),this.reduce(e)}function Li(t,e,r){t.multiplyTo(e,r),this.reduce(r)}xt.prototype.convert=Pi,xt.prototype.revert=Vi,xt.prototype.reduce=ji,xt.prototype.mulTo=Li,xt.prototype.sqrTo=Zi;function Ui(){return(this.t>0?this[0]&1:this.s)==0}function Ki(t,e){if(t>4294967295||t<1)return o.ONE;var r=a(),u=a(),c=e.convert(this),p=I(t)-1;for(c.copyTo(r);--p>=0;)if(e.sqrTo(r,u),(t&1<<p)>0)e.mulTo(u,c,r);else{var v=r;r=u,u=v}return e.revert(r)}function ki(t,e){var r;return t<256||e.isEven()?r=new pt(e):r=new xt(e),this.exp(t,r)}o.prototype.copyTo=q,o.prototype.fromInt=_,o.prototype.fromString=V,o.prototype.clamp=Z,o.prototype.dlShiftTo=lt,o.prototype.drShiftTo=St,o.prototype.lShiftTo=Pt,o.prototype.rShiftTo=Ii,o.prototype.subTo=Ai,o.prototype.multiplyTo=Ei,o.prototype.squareTo=Di,o.prototype.divRemTo=qi,o.prototype.invDigit=Ni,o.prototype.isEven=Ui,o.prototype.exp=Ki,o.prototype.toString=N,o.prototype.negate=k,o.prototype.abs=tt,o.prototype.compareTo=ft,o.prototype.bitLength=Bt,o.prototype.mod=Mi,o.prototype.modPowInt=ki,o.ZERO=O(0),o.ONE=O(1);function $i(){var t=a();return this.copyTo(t),t}function zi(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Gi(){return this.t==0?this.s:this[0]<<24>>24}function Ji(){return this.t==0?this.s:this[0]<<16>>16}function Yi(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function Xi(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function Qi(t){if(t==null&&(t=10),this.signum()==0||t<2||t>36)return"0";var e=this.chunkSize(t),r=Math.pow(t,e),u=O(r),c=a(),p=a(),v="";for(this.divRemTo(u,c,p);c.signum()>0;)v=(r+p.intValue()).toString(t).substr(1)+v,c.divRemTo(u,c,p);return p.intValue().toString(t)+v}function Wi(t,e){this.fromInt(0),e==null&&(e=10);for(var r=this.chunkSize(e),u=Math.pow(e,r),c=!1,p=0,v=0,b=0;b<t.length;++b){var M=D(t,b);if(M<0){t.charAt(b)=="-"&&this.signum()==0&&(c=!0);continue}v=e*v+M,++p>=r&&(this.dMultiply(u),this.dAddOffset(v,0),p=0,v=0)}p>0&&(this.dMultiply(Math.pow(e,p)),this.dAddOffset(v,0)),c&&o.ZERO.subTo(this,this)}function tn(t,e,r){if(typeof e=="number")if(t<2)this.fromInt(1);else for(this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(o.ONE.shiftLeft(t-1),Vt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(o.ONE.shiftLeft(t-1),this);else{var u=new Array,c=t&7;u.length=(t>>3)+1,e.nextBytes(u),c>0?u[0]&=(1<<c)-1:u[0]=0,this.fromString(u,256)}}function en(){var t=this.t,e=new Array;e[0]=this.s;var r=this.DB-t*this.DB%8,u,c=0;if(t-- >0)for(r<this.DB&&(u=this[t]>>r)!=(this.s&this.DM)>>r&&(e[c++]=u|this.s<<this.DB-r);t>=0;)r<8?(u=(this[t]&(1<<r)-1)<<8-r,u|=this[--t]>>(r+=this.DB-8)):(u=this[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),u&128&&(u|=-256),c==0&&(this.s&128)!=(u&128)&&++c,(c>0||u!=this.s)&&(e[c++]=u);return e}function nn(t){return this.compareTo(t)==0}function rn(t){return this.compareTo(t)<0?this:t}function sn(t){return this.compareTo(t)>0?this:t}function on(t,e,r){var u,c,p=Math.min(t.t,this.t);for(u=0;u<p;++u)r[u]=e(this[u],t[u]);if(t.t<this.t){for(c=t.s&this.DM,u=p;u<this.t;++u)r[u]=e(this[u],c);r.t=this.t}else{for(c=this.s&this.DM,u=p;u<t.t;++u)r[u]=e(c,t[u]);r.t=t.t}r.s=e(this.s,t.s),r.clamp()}function fn(t,e){return t&e}function hn(t){var e=a();return this.bitwiseTo(t,fn,e),e}function Vt(t,e){return t|e}function un(t){var e=a();return this.bitwiseTo(t,Vt,e),e}function de(t,e){return t^e}function an(t){var e=a();return this.bitwiseTo(t,de,e),e}function ve(t,e){return t&~e}function cn(t){var e=a();return this.bitwiseTo(t,ve,e),e}function ln(){for(var t=a(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}function pn(t){var e=a();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function xn(t){var e=a();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function dn(t){if(t==0)return-1;var e=0;return t&65535||(t>>=16,e+=16),t&255||(t>>=8,e+=8),t&15||(t>>=4,e+=4),t&3||(t>>=2,e+=2),t&1||++e,e}function vn(){for(var t=0;t<this.t;++t)if(this[t]!=0)return t*this.DB+dn(this[t]);return this.s<0?this.t*this.DB:-1}function gn(t){for(var e=0;t!=0;)t&=t-1,++e;return e}function yn(){for(var t=0,e=this.s&this.DM,r=0;r<this.t;++r)t+=gn(this[r]^e);return t}function mn(t){var e=Math.floor(t/this.DB);return e>=this.t?this.s!=0:(this[e]&1<<t%this.DB)!=0}function bn(t,e){var r=o.ONE.shiftLeft(t);return this.bitwiseTo(r,e,r),r}function wn(t){return this.changeBit(t,Vt)}function Tn(t){return this.changeBit(t,ve)}function Fn(t){return this.changeBit(t,de)}function Bn(t,e){for(var r=0,u=0,c=Math.min(t.t,this.t);r<c;)u+=this[r]+t[r],e[r++]=u&this.DM,u>>=this.DB;if(t.t<this.t){for(u+=t.s;r<this.t;)u+=this[r],e[r++]=u&this.DM,u>>=this.DB;u+=this.s}else{for(u+=this.s;r<t.t;)u+=t[r],e[r++]=u&this.DM,u>>=this.DB;u+=t.s}e.s=u<0?-1:0,u>0?e[r++]=u:u<-1&&(e[r++]=this.DV+u),e.t=r,e.clamp()}function Sn(t){var e=a();return this.addTo(t,e),e}function In(t){var e=a();return this.subTo(t,e),e}function An(t){var e=a();return this.multiplyTo(t,e),e}function En(){var t=a();return this.squareTo(t),t}function Dn(t){var e=a();return this.divRemTo(t,e,null),e}function qn(t){var e=a();return this.divRemTo(t,null,e),e}function Mn(t){var e=a(),r=a();return this.divRemTo(t,e,r),new Array(e,r)}function On(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function Cn(t,e){if(t!=0){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function It(){}function ge(t){return t}function Rn(t,e,r){t.multiplyTo(e,r)}function _n(t,e){t.squareTo(e)}It.prototype.convert=ge,It.prototype.revert=ge,It.prototype.mulTo=Rn,It.prototype.sqrTo=_n;function Hn(t){return this.exp(t,new It)}function Nn(t,e,r){var u=Math.min(this.t+t.t,e);for(r.s=0,r.t=u;u>0;)r[--u]=0;var c;for(c=r.t-this.t;u<c;++u)r[u+this.t]=this.am(0,t[u],r,u,0,this.t);for(c=Math.min(t.t,e);u<c;++u)this.am(0,t[u],r,u,0,e-u);r.clamp()}function Pn(t,e,r){--e;var u=r.t=this.t+t.t-e;for(r.s=0;--u>=0;)r[u]=0;for(u=Math.max(e-this.t,0);u<t.t;++u)r[this.t+u-e]=this.am(e-u,t[u],r,0,0,this.t+u-e);r.clamp(),r.drShiftTo(1,r)}function dt(t){this.r2=a(),this.q3=a(),o.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function Vn(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=a();return t.copyTo(e),this.reduce(e),e}function jn(t){return t}function Zn(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function Ln(t,e){t.squareTo(e),this.reduce(e)}function Un(t,e,r){t.multiplyTo(e,r),this.reduce(r)}dt.prototype.convert=Vn,dt.prototype.revert=jn,dt.prototype.reduce=Zn,dt.prototype.mulTo=Un,dt.prototype.sqrTo=Ln;function Kn(t,e){var r=t.bitLength(),u,c=O(1),p;if(r<=0)return c;r<18?u=1:r<48?u=3:r<144?u=4:r<768?u=5:u=6,r<8?p=new pt(e):e.isEven()?p=new dt(e):p=new xt(e);var v=new Array,b=3,M=u-1,R=(1<<u)-1;if(v[1]=p.convert(this),u>1){var $=a();for(p.sqrTo(v[1],$);b<=R;)v[b]=a(),p.mulTo($,v[b-2],v[b]),b+=2}var U=t.t-1,et,Ct=!0,Q=a(),W;for(r=I(t[U])-1;U>=0;){for(r>=M?et=t[U]>>r-M&R:(et=(t[U]&(1<<r+1)-1)<<M-r,U>0&&(et|=t[U-1]>>this.DB+r-M)),b=u;!(et&1);)et>>=1,--b;if((r-=b)<0&&(r+=this.DB,--U),Ct)v[et].copyTo(c),Ct=!1;else{for(;b>1;)p.sqrTo(c,Q),p.sqrTo(Q,c),b-=2;b>0?p.sqrTo(c,Q):(W=c,c=Q,Q=W),p.mulTo(Q,v[et],c)}for(;U>=0&&!(t[U]&1<<r);)p.sqrTo(c,Q),W=c,c=Q,Q=W,--r<0&&(r=this.DB-1,--U)}return p.revert(c)}function kn(t){var e=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(e.compareTo(r)<0){var u=e;e=r,r=u}var c=e.getLowestSetBit(),p=r.getLowestSetBit();if(p<0)return e;for(c<p&&(p=c),p>0&&(e.rShiftTo(p,e),r.rShiftTo(p,r));e.signum()>0;)(c=e.getLowestSetBit())>0&&e.rShiftTo(c,e),(c=r.getLowestSetBit())>0&&r.rShiftTo(c,r),e.compareTo(r)>=0?(e.subTo(r,e),e.rShiftTo(1,e)):(r.subTo(e,r),r.rShiftTo(1,r));return p>0&&r.lShiftTo(p,r),r}function $n(t){if(t<=0)return 0;var e=this.DV%t,r=this.s<0?t-1:0;if(this.t>0)if(e==0)r=this[0]%t;else for(var u=this.t-1;u>=0;--u)r=(e*r+this[u])%t;return r}function zn(t){var e=t.isEven();if(this.isEven()&&e||t.signum()==0)return o.ZERO;for(var r=t.clone(),u=this.clone(),c=O(1),p=O(0),v=O(0),b=O(1);r.signum()!=0;){for(;r.isEven();)r.rShiftTo(1,r),e?((!c.isEven()||!p.isEven())&&(c.addTo(this,c),p.subTo(t,p)),c.rShiftTo(1,c)):p.isEven()||p.subTo(t,p),p.rShiftTo(1,p);for(;u.isEven();)u.rShiftTo(1,u),e?((!v.isEven()||!b.isEven())&&(v.addTo(this,v),b.subTo(t,b)),v.rShiftTo(1,v)):b.isEven()||b.subTo(t,b),b.rShiftTo(1,b);r.compareTo(u)>=0?(r.subTo(u,r),e&&c.subTo(v,c),p.subTo(b,p)):(u.subTo(r,u),e&&v.subTo(c,v),b.subTo(p,b))}if(u.compareTo(o.ONE)!=0)return o.ZERO;if(b.compareTo(t)>=0)return b.subtract(t);if(b.signum()<0)b.addTo(t,b);else return b;return b.signum()<0?b.add(t):b}var P=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Gn=(1<<26)/P[P.length-1];function Jn(t){var e,r=this.abs();if(r.t==1&&r[0]<=P[P.length-1]){for(e=0;e<P.length;++e)if(r[0]==P[e])return!0;return!1}if(r.isEven())return!1;for(e=1;e<P.length;){for(var u=P[e],c=e+1;c<P.length&&u<Gn;)u*=P[c++];for(u=r.modInt(u);e<c;)if(u%P[e++]==0)return!1}return r.millerRabin(t)}function Yn(t){var e=this.subtract(o.ONE),r=e.getLowestSetBit();if(r<=0)return!1;var u=e.shiftRight(r);t=t+1>>1,t>P.length&&(t=P.length);for(var c=a(),p=0;p<t;++p){c.fromInt(P[Math.floor(Math.random()*P.length)]);var v=c.modPow(u,this);if(v.compareTo(o.ONE)!=0&&v.compareTo(e)!=0){for(var b=1;b++<r&&v.compareTo(e)!=0;)if(v=v.modPowInt(2,this),v.compareTo(o.ONE)==0)return!1;if(v.compareTo(e)!=0)return!1}}return!0}o.prototype.chunkSize=Yi,o.prototype.toRadix=Qi,o.prototype.fromRadix=Wi,o.prototype.fromNumber=tn,o.prototype.bitwiseTo=on,o.prototype.changeBit=bn,o.prototype.addTo=Bn,o.prototype.dMultiply=On,o.prototype.dAddOffset=Cn,o.prototype.multiplyLowerTo=Nn,o.prototype.multiplyUpperTo=Pn,o.prototype.modInt=$n,o.prototype.millerRabin=Yn,o.prototype.clone=$i,o.prototype.intValue=zi,o.prototype.byteValue=Gi,o.prototype.shortValue=Ji,o.prototype.signum=Xi,o.prototype.toByteArray=en,o.prototype.equals=nn,o.prototype.min=rn,o.prototype.max=sn,o.prototype.and=hn,o.prototype.or=un,o.prototype.xor=an,o.prototype.andNot=cn,o.prototype.not=ln,o.prototype.shiftLeft=pn,o.prototype.shiftRight=xn,o.prototype.getLowestSetBit=vn,o.prototype.bitCount=yn,o.prototype.testBit=mn,o.prototype.setBit=wn,o.prototype.clearBit=Tn,o.prototype.flipBit=Fn,o.prototype.add=Sn,o.prototype.subtract=In,o.prototype.multiply=An,o.prototype.divide=Dn,o.prototype.remainder=qn,o.prototype.divideAndRemainder=Mn,o.prototype.modPow=Kn,o.prototype.modInverse=zn,o.prototype.pow=Hn,o.prototype.gcd=kn,o.prototype.isProbablePrime=Jn,o.prototype.square=En,o.prototype.Barrett=dt;var Ot,L,C;function Xn(t){L[C++]^=t&255,L[C++]^=t>>8&255,L[C++]^=t>>16&255,L[C++]^=t>>24&255,C>=Zt&&(C-=Zt)}function ye(){Xn(new Date().getTime())}if(L==null){L=new Array,C=0;var X;if(typeof window<"u"&&window.crypto){if(window.crypto.getRandomValues){var me=new Uint8Array(32);for(window.crypto.getRandomValues(me),X=0;X<32;++X)L[C++]=me[X]}else if(navigator.appName=="Netscape"&&navigator.appVersion<"5"){var be=window.crypto.random(32);for(X=0;X<be.length;++X)L[C++]=be.charCodeAt(X)&255}}for(;C<Zt;)X=Math.floor(65536*Math.random()),L[C++]=X>>>8,L[C++]=X&255;C=0,ye()}function Qn(){if(Ot==null){for(ye(),Ot=ir(),Ot.init(L),C=0;C<L.length;++C)L[C]=0;C=0}return Ot.next()}function Wn(t){var e;for(e=0;e<t.length;++e)t[e]=Qn()}function we(){}we.prototype.nextBytes=Wn;function jt(){this.i=0,this.j=0,this.S=new Array}function tr(t){var e,r,u;for(e=0;e<256;++e)this.S[e]=e;for(r=0,e=0;e<256;++e)r=r+this.S[e]+t[e%t.length]&255,u=this.S[e],this.S[e]=this.S[r],this.S[r]=u;this.i=0,this.j=0}function er(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]}jt.prototype.init=tr,jt.prototype.next=er;function ir(){return new jt}var Zt=256;n.exports={default:o,BigInteger:o,SecureRandom:we}}).call(Fe)})(Be);const{BigInteger:gt}=z;function Se(n){let i=n.toString(16);if(i[0]!=="-")i.length%2===1?i="0"+i:i.match(/^[0-7]/)||(i="00"+i);else{i=i.substr(1);let s=i.length;s%2===1?s+=1:i.match(/^[0-7]/)||(s+=2);let f="";for(let h=0;h<s;h++)f+="f";f=new gt(f,16),i=f.xor(n).add(gt.ONE),i=i.toString(16).replace(/^-/,"")}return i}class Ut{constructor(){this.tlv=null,this.t="00",this.l="00",this.v=""}getEncodedHex(){return this.tlv||(this.v=this.getValue(),this.l=this.getLength(),this.tlv=this.t+this.l+this.v),this.tlv}getLength(){const i=this.v.length/2;let s=i.toString(16);return s.length%2===1&&(s="0"+s),i<128?s:(128+s.length/2).toString(16)+s}getValue(){return""}}class Kt extends Ut{constructor(i){super(),this.t="02",i&&(this.v=Se(i))}getValue(){return this.v}}class Ie extends Ut{constructor(i){super(),this.t="30",this.asn1Array=i}getValue(){return this.v=this.asn1Array.map(i=>i.getEncodedHex()).join(""),this.v}}function kt(n,i){return+n[i+2]<8?1:+n.substr(i+2,2)&127+1}function $t(n,i){const s=kt(n,i),f=n.substr(i+2,s*2);return f?(+f[0]<8?new gt(f,16):new gt(f.substr(2),16)).intValue():-1}function _t(n,i){const s=kt(n,i);return i+(s+1)*2}var Ae={encodeDer(n,i){const s=new Kt(n),f=new Kt(i);return new Ie([s,f]).getEncodedHex()},decodeDer(n){const i=_t(n,0),s=_t(n,i),f=$t(n,i),h=n.substr(s,f*2),o=s+h.length,a=_t(n,o),y=$t(n,o),l=n.substr(a,y*2),w=new gt(h,16),g=new gt(l,16);return{r:w,s:g}}};const{BigInteger:H}=z,zt=new H("2"),Gt=new H("3");class it{constructor(i,s){this.x=s,this.q=i}equals(i){return i===this?!0:this.q.equals(i.q)&&this.x.equals(i.x)}toBigInteger(){return this.x}negate(){return new it(this.q,this.x.negate().mod(this.q))}add(i){return new it(this.q,this.x.add(i.toBigInteger()).mod(this.q))}subtract(i){return new it(this.q,this.x.subtract(i.toBigInteger()).mod(this.q))}multiply(i){return new it(this.q,this.x.multiply(i.toBigInteger()).mod(this.q))}divide(i){return new it(this.q,this.x.multiply(i.toBigInteger().modInverse(this.q)).mod(this.q))}square(){return new it(this.q,this.x.square().mod(this.q))}}class nt{constructor(i,s,f,h){this.curve=i,this.x=s,this.y=f,this.z=h??H.ONE,this.zinv=null}getX(){return this.zinv===null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))}getY(){return this.zinv===null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))}equals(i){return i===this?!0:this.isInfinity()?i.isInfinity():i.isInfinity()?this.isInfinity():i.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(i.z)).mod(this.curve.q).equals(H.ZERO)?i.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(i.z)).mod(this.curve.q).equals(H.ZERO):!1}isInfinity(){return this.x===null&&this.y===null?!0:this.z.equals(H.ZERO)&&!this.y.toBigInteger().equals(H.ZERO)}negate(){return new nt(this.curve,this.x,this.y.negate(),this.z)}add(i){if(this.isInfinity())return i;if(i.isInfinity())return this;const s=this.x.toBigInteger(),f=this.y.toBigInteger(),h=this.z,o=i.x.toBigInteger(),a=i.y.toBigInteger(),y=i.z,l=this.curve.q,w=s.multiply(y).mod(l),g=o.multiply(h).mod(l),x=w.subtract(g),m=f.multiply(y).mod(l),T=a.multiply(h).mod(l),d=m.subtract(T);if(H.ZERO.equals(x))return H.ZERO.equals(d)?this.twice():this.curve.infinity;const F=w.add(g),E=h.multiply(y).mod(l),D=x.square().mod(l),q=x.multiply(D).mod(l),_=E.multiply(d.square()).subtract(F.multiply(D)).mod(l),O=x.multiply(_).mod(l),V=d.multiply(D.multiply(w).subtract(_)).subtract(m.multiply(q)).mod(l),Z=q.multiply(E).mod(l);return new nt(this.curve,this.curve.fromBigInteger(O),this.curve.fromBigInteger(V),Z)}twice(){if(this.isInfinity())return this;if(!this.y.toBigInteger().signum())return this.curve.infinity;const i=this.x.toBigInteger(),s=this.y.toBigInteger(),f=this.z,h=this.curve.q,o=this.curve.a.toBigInteger(),a=i.square().multiply(Gt).add(o.multiply(f.square())).mod(h),y=s.shiftLeft(1).multiply(f).mod(h),l=s.square().mod(h),w=l.multiply(i).multiply(f).mod(h),g=y.square().mod(h),x=a.square().subtract(w.shiftLeft(3)).mod(h),m=y.multiply(x).mod(h),T=a.multiply(w.shiftLeft(2).subtract(x)).subtract(g.shiftLeft(1).multiply(l)).mod(h),d=y.multiply(g).mod(h);return new nt(this.curve,this.curve.fromBigInteger(m),this.curve.fromBigInteger(T),d)}multiply(i){if(this.isInfinity())return this;if(!i.signum())return this.curve.infinity;const s=i.multiply(Gt),f=this.negate();let h=this;for(let o=s.bitLength()-2;o>0;o--){h=h.twice();const a=s.testBit(o),y=i.testBit(o);a!==y&&(h=h.add(a?this:f))}return h}}var Ee={ECPointFp:nt,ECCurveFp:class{constructor(i,s,f){this.q=i,this.a=this.fromBigInteger(s),this.b=this.fromBigInteger(f),this.infinity=new nt(this,null,null)}equals(i){return i===this?!0:this.q.equals(i.q)&&this.a.equals(i.a)&&this.b.equals(i.b)}fromBigInteger(i){return new it(this.q,i)}decodePointHex(i){switch(parseInt(i.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:const s=this.fromBigInteger(new H(i.substr(2),16));let f=this.fromBigInteger(s.multiply(s.square()).add(s.multiply(this.a)).add(this.b).toBigInteger().modPow(this.q.divide(new H("4")).add(H.ONE),this.q));return f.toBigInteger().mod(zt).equals(new H(i.substr(0,2),16).subtract(zt))||(f=f.negate()),new nt(this,s,f);case 4:case 6:case 7:const h=(i.length-2)/2,o=i.substr(2,h),a=i.substr(h+2,h);return new nt(this,this.fromBigInteger(new H(o,16)),this.fromBigInteger(new H(a,16)));default:return null}}}};const{BigInteger:G,SecureRandom:De}=z,{ECCurveFp:qe}=Ee,Me=new De,{curve:yt,G:Oe,n:Jt}=Yt();function Ce(){return yt}function Yt(){const n=new G("FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF",16),i=new G("FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC",16),s=new G("28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93",16),f=new qe(n,i,s),h="32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7",o="BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0",a=f.decodePointHex("04"+h+o),y=new G("FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123",16);return{curve:f,G:a,n:y}}function Re(n,i,s){const h=(n?new G(n,i,s):new G(Jt.bitLength(),Me)).mod(Jt.subtract(G.ONE)).add(G.ONE),o=Tt(h.toString(16),64),a=Oe.multiply(h),y=Tt(a.getX().toBigInteger().toString(16),64),l=Tt(a.getY().toBigInteger().toString(16),64),w="04"+y+l;return{privateKey:o,publicKey:w}}function _e(n){if(n.length!==130)throw new Error("Invalid public key to compress");const i=(n.length-2)/2,s=n.substr(2,i),f=new G(n.substr(i+2,i),16);let h="03";return f.mod(new G("2")).equals(G.ZERO)&&(h="02"),h+s}function He(n){n=unescape(encodeURIComponent(n));const i=n.length,s=[];for(let h=0;h<i;h++)s[h>>>2]|=(n.charCodeAt(h)&255)<<24-h%4*8;const f=[];for(let h=0;h<i;h++){const o=s[h>>>2]>>>24-h%4*8&255;f.push((o>>>4).toString(16)),f.push((o&15).toString(16))}return f.join("")}function Tt(n,i){return n.length>=i?n:new Array(i-n.length+1).join("0")+n}function Ne(n){return n.map(i=>(i=i.toString(16),i.length===1?"0"+i:i)).join("")}function Pe(n){const i=[];let s=0;for(let f=0;f<n.length*2;f+=2)i[f>>>3]|=parseInt(n[s],10)<<24-f%8*4,s++;try{const f=[];for(let h=0;h<n.length;h++){const o=i[h>>>2]>>>24-h%4*8&255;f.push(String.fromCharCode(o))}return decodeURIComponent(escape(f.join("")))}catch{throw new Error("Malformed UTF-8 data")}}function Ve(n){const i=[];let s=n.length;s%2!==0&&(n=Tt(n,s+1)),s=n.length;for(let f=0;f<s;f+=2)i.push(parseInt(n.substr(f,2),16));return i}function je(n){const i=yt.decodePointHex(n);if(!i)return!1;const s=i.getX();return i.getY().square().equals(s.multiply(s.square()).add(s.multiply(yt.a)).add(yt.b))}function Ze(n,i){const s=yt.decodePointHex(n);if(!s)return!1;const f=yt.decodePointHex(i);return f?s.equals(f):!1}var Le={getGlobalCurve:Ce,generateEcparam:Yt,generateKeyPairHex:Re,compressPublicKeyHex:_e,utf8ToHex:He,leftPad:Tt,arrayToHex:Ne,arrayToUtf8:Pe,hexToArray:Ve,verifyPublicKey:je,comparePublicKeyHex:Ze};const J=new Uint32Array(68),Ht=new Uint32Array(64);function K(n,i){const s=i&31;return n<<s|n>>>32-s}function Xt(n,i){const s=[];for(let f=n.length-1;f>=0;f--)s[f]=(n[f]^i[f])&255;return s}function Ue(n){return n^K(n,9)^K(n,17)}function Ke(n){return n^K(n,15)^K(n,23)}function At(n){let i=n.length*8,s=i%512;s=s>=448?512-s%448-1:448-s-1;const f=new Array((s-7)/8),h=new Array(8);for(let g=0,x=f.length;g<x;g++)f[g]=0;for(let g=0,x=h.length;g<x;g++)h[g]=0;i=i.toString(2);for(let g=7;g>=0;g--)if(i.length>8){const x=i.length-8;h[g]=parseInt(i.substr(x),2),i=i.substr(0,x)}else i.length>0&&(h[g]=parseInt(i,2),i="");const o=new Uint8Array([...n,128,...f,...h]),a=new DataView(o.buffer,0),y=o.length/64,l=new Uint32Array([1937774191,1226093241,388252375,3666478592,2842636476,372324522,3817729613,2969243214]);for(let g=0;g<y;g++){J.fill(0),Ht.fill(0);const x=16*g;for(let I=0;I<16;I++)J[I]=a.getUint32((x+I)*4,!1);for(let I=16;I<68;I++)J[I]=Ke(J[I-16]^J[I-9]^K(J[I-3],15))^K(J[I-13],7)^J[I-6];for(let I=0;I<64;I++)Ht[I]=J[I]^J[I+4];const m=2043430169,T=2055708042;let d=l[0],F=l[1],E=l[2],D=l[3],q=l[4],_=l[5],O=l[6],V=l[7],Z,N,k,tt,ft;for(let I=0;I<64;I++)ft=I>=0&&I<=15?m:T,Z=K(K(d,12)+q+K(ft,I),7),N=Z^K(d,12),k=(I>=0&&I<=15?d^F^E:d&F|d&E|F&E)+D+N+Ht[I],tt=(I>=0&&I<=15?q^_^O:q&_|~q&O)+V+Z+J[I],D=E,E=K(F,9),F=d,d=k,V=O,O=K(_,19),_=q,q=Ue(tt);l[0]^=d,l[1]^=F,l[2]^=E,l[3]^=D,l[4]^=q,l[5]^=_,l[6]^=O,l[7]^=V}const w=[];for(let g=0,x=l.length;g<x;g++){const m=l[g];w.push((m&4278190080)>>>24,(m&16711680)>>>16,(m&65280)>>>8,m&255)}return w}const Ft=64,Qt=new Uint8Array(Ft),Wt=new Uint8Array(Ft);for(let n=0;n<Ft;n++)Qt[n]=54,Wt[n]=92;function ke(n,i){for(i.length>Ft&&(i=At(i));i.length<Ft;)i.push(0);const s=Xt(i,Qt),f=Xt(i,Wt),h=At([...s,...n]);return At([...f,...h])}var te={sm3:At,hmac:ke};const{BigInteger:j}=z,{encodeDer:$e,decodeDer:ze}=Ae,S=Le,mt=te.sm3,{G:at,curve:ee,n:bt}=S.generateEcparam(),ie=0;function Ge(n,i,s=1){n=typeof n=="string"?S.hexToArray(S.utf8ToHex(n)):Array.prototype.slice.call(n),i=S.getGlobalCurve().decodePointHex(i);const f=S.generateKeyPairHex(),h=new j(f.privateKey,16);let o=f.publicKey;o.length>128&&(o=o.substr(o.length-128));const a=i.multiply(h),y=S.hexToArray(S.leftPad(a.getX().toBigInteger().toRadix(16),64)),l=S.hexToArray(S.leftPad(a.getY().toBigInteger().toRadix(16),64)),w=S.arrayToHex(mt([].concat(y,n,l)));let g=1,x=0,m=[];const T=[].concat(y,l),d=()=>{m=mt([...T,g>>24&255,g>>16&255,g>>8&255,g&255]),g++,x=0};d();for(let E=0,D=n.length;E<D;E++)x===m.length&&d(),n[E]^=m[x++]&255;const F=S.arrayToHex(n);return s===ie?o+F+w:o+w+F}function Je(n,i,s=1,{output:f="string"}={}){i=new j(i,16);let h=n.substr(128,64),o=n.substr(128+64);s===ie&&(h=n.substr(n.length-64),o=n.substr(128,n.length-128-64));const a=S.hexToArray(o),l=S.getGlobalCurve().decodePointHex("04"+n.substr(0,128)).multiply(i),w=S.hexToArray(S.leftPad(l.getX().toBigInteger().toRadix(16),64)),g=S.hexToArray(S.leftPad(l.getY().toBigInteger().toRadix(16),64));let x=1,m=0,T=[];const d=[].concat(w,g),F=()=>{T=mt([...d,x>>24&255,x>>16&255,x>>8&255,x&255]),x++,m=0};F();for(let D=0,q=a.length;D<q;D++)m===T.length&&F(),a[D]^=T[m++]&255;return S.arrayToHex(mt([].concat(w,a,g)))===h.toLowerCase()?f==="array"?a:S.arrayToUtf8(a):f==="array"?[]:""}function Ye(n,i,{pointPool:s,der:f,hash:h,publicKey:o,userId:a}={}){let y=typeof n=="string"?S.utf8ToHex(n):S.arrayToHex(n);h&&(o=o||Qe(i),y=ne(y,o,a));const l=new j(i,16),w=new j(y,16);let g=null,x=null,m=null;do{do{let T;s&&s.length?T=s.pop():T=re(),g=T.k,x=w.add(T.x1).mod(bt)}while(x.equals(j.ZERO)||x.add(g).equals(bt));m=l.add(j.ONE).modInverse(bt).multiply(g.subtract(x.multiply(l))).mod(bt)}while(m.equals(j.ZERO));return f?$e(x,m):S.leftPad(x.toString(16),64)+S.leftPad(m.toString(16),64)}function Xe(n,i,s,{der:f,hash:h,userId:o}={}){let a=typeof n=="string"?S.utf8ToHex(n):S.arrayToHex(n);h&&(a=ne(a,s,o));let y,l;if(f){const d=ze(i);y=d.r,l=d.s}else y=new j(i.substring(0,64),16),l=new j(i.substring(64),16);const w=ee.decodePointHex(s),g=new j(a,16),x=y.add(l).mod(bt);if(x.equals(j.ZERO))return!1;const m=at.multiply(l).add(w.multiply(x)),T=g.add(m.getX().toBigInteger()).mod(bt);return y.equals(T)}function ne(n,i,s="1234567812345678"){s=S.utf8ToHex(s);const f=S.leftPad(at.curve.a.toBigInteger().toRadix(16),64),h=S.leftPad(at.curve.b.toBigInteger().toRadix(16),64),o=S.leftPad(at.getX().toBigInteger().toRadix(16),64),a=S.leftPad(at.getY().toBigInteger().toRadix(16),64);let y,l;if(i.length===128)y=i.substr(0,64),l=i.substr(64,64);else{const m=at.curve.decodePointHex(i);y=S.leftPad(m.getX().toBigInteger().toRadix(16),64),l=S.leftPad(m.getY().toBigInteger().toRadix(16),64)}const w=S.hexToArray(s+f+h+o+a+y+l),g=s.length*4;w.unshift(g&255),w.unshift(g>>8&255);const x=mt(w);return S.arrayToHex(mt(x.concat(S.hexToArray(n))))}function Qe(n){const i=at.multiply(new j(n,16)),s=S.leftPad(i.getX().toBigInteger().toString(16),64),f=S.leftPad(i.getY().toBigInteger().toString(16),64);return"04"+s+f}function re(){const n=S.generateKeyPairHex(),i=ee.decodePointHex(n.publicKey);return n.k=new j(n.privateKey,16),n.x1=i.getX().toBigInteger(),n}var We={generateKeyPairHex:S.generateKeyPairHex,compressPublicKeyHex:S.compressPublicKeyHex,comparePublicKeyHex:S.comparePublicKeyHex,doEncrypt:Ge,doDecrypt:Je,doSignature:Ye,doVerifySignature:Xe,getPoint:re,verifyPublicKey:S.verifyPublicKey};const{sm3:ti,hmac:ei}=te;function ii(n,i){return n.length>=i?n:new Array(i-n.length+1).join("0")+n}function se(n){return n.map(i=>(i=i.toString(16),i.length===1?"0"+i:i)).join("")}function ni(n){const i=[];let s=n.length;s%2!==0&&(n=ii(n,s+1)),s=n.length;for(let f=0;f<s;f+=2)i.push(parseInt(n.substr(f,2),16));return i}function ri(n){const i=[];for(let s=0,f=n.length;s<f;s++){const h=n.codePointAt(s);if(h<=127)i.push(h);else if(h<=2047)i.push(192|h>>>6),i.push(128|h&63);else if(h<=55295||h>=57344&&h<=65535)i.push(224|h>>>12),i.push(128|h>>>6&63),i.push(128|h&63);else if(h>=65536&&h<=1114111)s++,i.push(240|h>>>18&28),i.push(128|h>>>12&63),i.push(128|h>>>6&63),i.push(128|h&63);else throw i.push(h),new Error("input is not supported")}return i}var si=function(n,i){if(n=typeof n=="string"?ri(n):Array.prototype.slice.call(n),i){if((i.mode||"hmac")!=="hmac")throw new Error("invalid mode");let f=i.key;if(!f)throw new Error("invalid key");return f=typeof f=="string"?ni(f):Array.prototype.slice.call(f),se(ei(n,f))}return se(ti(n))};const rt=0,oi=32,ct=16,Et=[214,144,233,254,204,225,61,183,22,182,20,194,40,251,44,5,43,103,154,118,42,190,4,195,170,68,19,38,73,134,6,153,156,66,80,244,145,239,152,122,51,84,11,67,237,207,172,98,228,179,28,169,201,8,232,149,128,223,148,250,117,143,63,166,71,7,167,252,243,115,23,186,131,89,60,25,230,133,79,168,104,107,129,178,113,100,218,139,248,235,15,75,112,86,157,53,30,36,14,94,99,88,209,162,37,34,124,59,1,33,120,135,212,0,70,87,159,211,39,82,76,54,2,231,160,196,200,158,234,191,138,210,64,199,56,181,163,247,242,206,249,97,21,161,224,174,93,164,155,52,26,85,173,147,50,48,245,140,177,227,29,246,226,46,130,102,202,96,192,41,35,171,13,83,78,111,213,219,55,69,222,253,142,47,3,255,106,114,109,108,91,81,141,27,175,146,187,221,188,127,17,217,92,65,31,16,90,216,10,193,49,136,165,205,123,189,45,116,208,18,184,229,180,176,137,105,151,74,12,150,119,126,101,185,241,9,197,110,198,132,24,240,125,236,58,220,77,32,121,238,95,62,215,203,57,72],Dt=[462357,472066609,943670861,1415275113,1886879365,2358483617,2830087869,3301692121,3773296373,4228057617,404694573,876298825,1347903077,1819507329,2291111581,2762715833,3234320085,3705924337,4177462797,337322537,808926789,1280531041,1752135293,2223739545,2695343797,3166948049,3638552301,4110090761,269950501,741554753,1213159005,1684763257];function Nt(n){const i=[];for(let s=0,f=n.length;s<f;s+=2)i.push(parseInt(n.substr(s,2),16));return i}function fi(n){return n.map(i=>(i=i.toString(16),i.length===1?"0"+i:i)).join("")}function hi(n){const i=[];for(let s=0,f=n.length;s<f;s++){const h=n.codePointAt(s);if(h<=127)i.push(h);else if(h<=2047)i.push(192|h>>>6),i.push(128|h&63);else if(h<=55295||h>=57344&&h<=65535)i.push(224|h>>>12),i.push(128|h>>>6&63),i.push(128|h&63);else if(h>=65536&&h<=1114111)s++,i.push(240|h>>>18&28),i.push(128|h>>>12&63),i.push(128|h>>>6&63),i.push(128|h&63);else throw i.push(h),new Error("input is not supported")}return i}function ui(n){const i=[];for(let s=0,f=n.length;s<f;s++)n[s]>=240&&n[s]<=247?(i.push(String.fromCodePoint(((n[s]&7)<<18)+((n[s+1]&63)<<12)+((n[s+2]&63)<<6)+(n[s+3]&63))),s+=3):n[s]>=224&&n[s]<=239?(i.push(String.fromCodePoint(((n[s]&15)<<12)+((n[s+1]&63)<<6)+(n[s+2]&63))),s+=2):n[s]>=192&&n[s]<=223?(i.push(String.fromCodePoint(((n[s]&31)<<6)+(n[s+1]&63))),s++):i.push(String.fromCodePoint(n[s]));return i.join("")}function wt(n,i){return n<<i|n>>>32-i}function st(n){return(Et[n>>>24&255]&255)<<24|(Et[n>>>16&255]&255)<<16|(Et[n>>>8&255]&255)<<8|Et[n&255]&255}function qt(n){return n^wt(n,2)^wt(n,10)^wt(n,18)^wt(n,24)}function Mt(n){return n^wt(n,13)^wt(n,23)}function ai(n,i,s){const f=new Array(4),h=new Array(4);for(let o=0;o<4;o++)h[0]=n[4*o]&255,h[1]=n[4*o+1]&255,h[2]=n[4*o+2]&255,h[3]=n[4*o+3]&255,f[o]=h[0]<<24|h[1]<<16|h[2]<<8|h[3];for(let o=0,a;o<32;o+=4)a=f[1]^f[2]^f[3]^s[o+0],f[0]^=qt(st(a)),a=f[2]^f[3]^f[0]^s[o+1],f[1]^=qt(st(a)),a=f[3]^f[0]^f[1]^s[o+2],f[2]^=qt(st(a)),a=f[0]^f[1]^f[2]^s[o+3],f[3]^=qt(st(a));for(let o=0;o<16;o+=4)i[o]=f[3-o/4]>>>24&255,i[o+1]=f[3-o/4]>>>16&255,i[o+2]=f[3-o/4]>>>8&255,i[o+3]=f[3-o/4]&255}function ci(n,i,s){const f=new Array(4),h=new Array(4);for(let o=0;o<4;o++)h[0]=n[0+4*o]&255,h[1]=n[1+4*o]&255,h[2]=n[2+4*o]&255,h[3]=n[3+4*o]&255,f[o]=h[0]<<24|h[1]<<16|h[2]<<8|h[3];f[0]^=2746333894,f[1]^=1453994832,f[2]^=1736282519,f[3]^=2993693404;for(let o=0,a;o<32;o+=4)a=f[1]^f[2]^f[3]^Dt[o+0],i[o+0]=f[0]^=Mt(st(a)),a=f[2]^f[3]^f[0]^Dt[o+1],i[o+1]=f[1]^=Mt(st(a)),a=f[3]^f[0]^f[1]^Dt[o+2],i[o+2]=f[2]^=Mt(st(a)),a=f[0]^f[1]^f[2]^Dt[o+3],i[o+3]=f[3]^=Mt(st(a));if(s===rt)for(let o=0,a;o<16;o++)a=i[o],i[o]=i[31-o],i[31-o]=a}function oe(n,i,s,{padding:f="pkcs#7",mode:h,iv:o=[],output:a="string"}={}){if(h==="cbc"&&(typeof o=="string"&&(o=Nt(o)),o.length!==128/8))throw new Error("iv is invalid");if(typeof i=="string"&&(i=Nt(i)),i.length!==128/8)throw new Error("key is invalid");if(typeof n=="string"?s!==rt?n=hi(n):n=Nt(n):n=[...n],(f==="pkcs#5"||f==="pkcs#7")&&s!==rt){const m=ct-n.length%ct;for(let T=0;T<m;T++)n.push(m)}const y=new Array(oi);ci(i,y,s);const l=[];let w=o,g=n.length,x=0;for(;g>=ct;){const m=n.slice(x,x+16),T=new Array(16);if(h==="cbc")for(let d=0;d<ct;d++)s!==rt&&(m[d]^=w[d]);ai(m,T,y);for(let d=0;d<ct;d++)h==="cbc"&&s===rt&&(T[d]^=w[d]),l[x+d]=T[d];h==="cbc"&&(s!==rt?w=T:w=m),g-=ct,x+=ct}if((f==="pkcs#5"||f==="pkcs#7")&&s===rt){const m=l.length,T=l[m-1];for(let d=1;d<=T;d++)if(l[m-d]!==T)throw new Error("padding is invalid");l.splice(m-T,T)}return a!=="array"?s!==rt?fi(l):ui(l):l}var li={encrypt(n,i,s){return oe(n,i,1,s)},decrypt(n,i,s){return oe(n,i,0,s)}},ot={sm2:We,sm3:si,sm4:li};function A(n,i){if(typeof n=="bigint"){if(i===void 0){i=0n;for(var s=n>>64n;s!=0n;)i+=8n,s>>=64n;for(s=n>>(i<<3n);s!=0n;)i+=1n,s>>=8n}else n>>(i<<3n)&&(n&=(1n<<(i<<3n))-1n);var f=pi(n.toString(16).padStart(Number(i*2n),"0")),h=new Uint8Array(f);return h}else if(typeof n=="string")return i&&n.length>i&&(n=n.slice(0,Number(i))),di(n);return new Uint8Array}function pi(n){var i=[],s=n.length;s%2!==0&&(n=xi(n,s+1)),s=n.length;for(var f=0;f<s;f+=2)i.push(parseInt(n.substr(f,2),16));return i}function xi(n,i){return n.length>=i?n:new Array(i-n.length+1).join("0")+n}function Y(n){var i=n.length,s=fe(n),f=new Uint8Array(s);f.set(n[0]);for(var h=1;h<i;h++)n[h]&&f.set(n[h],fe(n.slice(0,h)));return f}function fe(n){for(var i=n.length,s=0,f=0;f<i;f++)n[f]&&(s+=n[f].length);return s}function he(n){var i=Array.prototype.map.call(new Uint8Array(n),function(s){return("00"+s.toString(16)).slice(-2)});return i.join("")}function ue(n){var i=new ArrayBuffer(n.length/2),s=Array.prototype.map.call(new Uint8Array(i),function(f,h){return parseInt(n.slice(h*2,h*2+2),16)});return new Uint8Array(s)}function B(n,i){var s=n/i;(n<0n||i<0n)&&s<=0n&&n+i!=0n&&(s-=1n),n<0n&&i<0n&&n>i&&(s+=1n);var f=n-s*i;return f}function di(n){var i=n.split("").map(function(s){return s.charCodeAt(0)});return new Uint8Array(i)}function ae(n,i){return i==0n?n:ae(i,B(n,i))}function ce(n,i){if(i===0n)return[1n,0n];var s=ce(i,B(n,i)),f=s[0],h=s[1];return[h,f-n/i*h]}function le(n,i){if(ae(n,i)===1n){var s=ce(n,i),f=s[0];return s[1],B(f,i)}else return 1n}var vi=32;function pe(n,i){typeof n!="string"&&(n=he(n));for(var s=i>>3,f="",h=1;h<Math.ceil(s/vi)+1;h++){var o=ue(n+he(A(BigInt(h),4n))),a=ot.sm3(o);f=f+a}return f.slice(0,s*2)}function gi(n){if(typeof n=="number"){for(var i=0,s=n>>64;s!==0;)i+=64,s>>=64;for(s=n>>i>>>8;s!==0;)i+=8,s>>=8;for(n>>=i;n!==0;)i+=1,n>>=1;return i}else{if(typeof n=="string")return n.length*8;if(Buffer.isBuffer(n))return n.length*8}return 0}var yi=function(){function n(i,s,f,h,o,a){this.p=i,this.a=s,this.b=f,this.n=h,this.G=o,a&&(this.h=a),this.O=[-1n,-1n],this._2=le(2n,i),this.a_3=B(s+3n,i)}return n.prototype.genKeyPaire=function(){var i=new z.SecureRandom,s=new z.BigInteger(this.n.toString(16)),f=this.n.toString(16).length*4,h=new z.BigInteger(f,i),o=h.mod(s.subtract(z.BigInteger.ONE)).add(z.BigInteger.ONE),a=BigInt(o.toString()),y=this.Jacb_multiply(a,this.G);return{publicKey:{x:y[0],y:y[1]},privateKey:a}},n.prototype.Jacb_multiply=function(i,s,f){f===void 0&&(f=!0);var h;if(i===0n||s[0]==this.O[0]&&s[1]==this.O[1])return this.O;var o=(3n*i).toString(2),a=i.toString(2);a="0".repeat(o.length-a.length)+a,h=Array.from(s);for(var y=this.minus(s),l=1;l<o.length-1;l++)h=this.Jacb_add(h),o[l]==="1"&&a[l]==="0"?h=this.Jacb_add(h,s):o[l]==="0"&&a[l]==="1"&&(h=this.Jacb_add(h,y));return f?this.Jacb_to_affine(h):h},n.prototype.Jacb_add=function(i,s){var f;s===void 0&&(s=null);var h,o,a,y,l;if(!s||i===s){if(i===this.O)return this.O;var w=i[0],g=i[1],x=i[2]||1n;if(l=B(g*x<<1n,this.p),l===0n)return this.O;h=B(g*g,this.p),o=B(h<<3n,this.p);var m=B(w*o,this.p),T=B(x*x,this.p),d=B((w+T)*(w-T)*3n,this.p);d=B(d+this.a_3*T*T,this.p);var F=B(d*d,this.p);h=B(h*o,this.p),a=B(F-m,this.p),o=m&1n?m+(m+this.p>>1n)-F:m+(m>>1n)-F,d=B(d*o,this.p),y=B(d-h,this.p)}else{if(i===this.O)return s;if(s===this.O)return i;var w=i[0],g=i[1],x=i[2]||1n,E=s[0],D=s[1],q=s[2]||1n;if(q!=1n&&x!=1n){var _=B(x*x,this.p),O=B(q*q,this.p),d=B(w*O,this.p);h=B(E*_,this.p);var F=d-h;if(l=B(x*q*F,this.p),l==0n)return this.O;o=B(g*q*O,this.p);var m=B(D*x*_,this.p),T=o-m,V=d+h,Z=o+m,N=B(F*F,this.p);a=B(T*T-V*N,this.p);var k=B(V*N-(a<<1n),this.p);y=B((k*T-Z*F*N)*this._2,this.p)}else{x===1n&&(f=[E,D,q,w,g],w=f[0],g=f[1],x=f[2],E=f[3],D=f[4]);var d=B(x*x,this.p);h=B(D*x,this.p);var F=B(E*d,this.p);if(d=B(d*h,this.p),h=F-w,l=B(x*h,this.p),l===0n)return this.O;F+=w,d-=g,o=B(h*h,this.p);var m=B(d*d,this.p);h=B(h*o,this.p),F=B(F*o,this.p),o=B(w*o,this.p),a=m-B(F,this.p),h=B(g*h,this.p),F=o-a,d=B(d*F,this.p),y=d-B(h,this.p)}}return[a,y,l]},n.prototype.Jacb_to_affine=function(i){if(i.length==2)return i;var s=i[0],f=i[1],h=i[2];if(h==0n)return this.O;var o=le(h,this.p),a=B(s*o*o,this.p),y=B(f*o*o*o,this.p);return[a,y]},n.prototype.minus=function(i){var s=Array.from(i);return s[1]=-s[1],s},n.prototype.isZero=function(i){return i.length==2?i==this.O:i[2]==0n},n.prototype.onCurve=function(i){if(this.isZero(i))return!1;if(i.length==2){var s=i[0],f=i[1];return f*f%this.p==(s*s*s+this.a*s+this.b)%this.p}else{var s=i[0],f=i[1],h=i[2];return f*f%this.p==(s*s*s+this.a*s*B(Math.pow(h,4n),this.p)+this.b*B(Math.pow(h,6n),this.p))%this.p}},n}(),mi=0x8542d69e4c044f18e8b92435bf6ff7de457283915c45517d722edb8b08f1dfc3n,bi=0x787968b4fa32c3fd2417842e73bbfeff2f3c848b6831d7e0ec65228b3937e498n,wi=0x63e4c6d3b23b0c849cf84241484bfe48f61d59a5b16ba06e6e12d1da27c5249an,Ti=0x8542d69e4c044f18e8b92435bf6ff7dd297720630485628d5ae74ee7c32e79b7n,Fi=0x421debd61b62eab6746434ebc3cc315e32220b3badd50bdc4c4e6c147fedd43dn,Bi=0x0680512bcbb42c07d47349d2153b70c4e5d7fdfcbfa36ea1a85841b9e46e09a2n,xe=128,Si=function(n){Te(i,n);function i(s,f,h,o,a,y,l,w,g,x){s===void 0&&(s=mi),f===void 0&&(f=bi),h===void 0&&(h=wi),o===void 0&&(o=Ti),a===void 0&&(a=[Fi,Bi]),y===void 0&&(y=1n),l===void 0&&(l="");var m=n.call(this,s,f,h,o,a,y)||this;return m.h=y,typeof l=="string"||typeof l=="number"?m.ID=l:m.ID=null,!w||!g?m.initKey():(m.pk=g,m.sk=w),m}return i.prototype.initKey=function(){var s=this.genKeyPaire();this.pk=s.publicKey,this.sk=s.privateKey},i.prototype.getZ=function(s,f){var h=!1;if(!f){if(Object.hasOwnProperty.call(this,"Z"))return this.Z;s=this.ID,f=this.pk,h=!0}if(f){var o=gi(s),a=A(BigInt(o),2n),y=[a,A(s),A(this.a),A(this.b),A(this.G[0]),A(this.G[1]),A(BigInt(f.x)),A(BigInt(f.y))],l=Y(y),w=ue(ot.sm3(l));return h&&(this.Z=w),w}},i.prototype.agreement_initiate=function(){return this.genKeyPaire()},i.prototype.agreement_response=function(s,f,h,o,a,y,l){h===void 0&&(h=""),o===void 0&&(o=!1),a===void 0&&(a=null),y===void 0&&(y=null),l===void 0&&(l=null);var w=BigInt(s.x),g=BigInt(s.y);if(!this.onCurve([w,g]))throw new Error("不在曲线上");var x=127n,m=1n,T=this.getZ(h,f),d=this.getZ();if(!a||!y){var F=this.genKeyPaire();y=F.publicKey,a=F.privateKey}var E=BigInt(y.x),D=BigInt(y.y),q=(1n<<x)+(E&(1n<<x)-1n),_=(BigInt(this.sk)+q*BigInt(a))%this.n,O=m*_,V=(1n<<x)+(w&(1n<<x)-1n),Z=this.Jacb_add(this.Jacb_multiply(V,[BigInt(s.x),BigInt(s.y)],!1),[BigInt(f.x),BigInt(f.y)]),N=this.Jacb_multiply(O,Z);if(this.isZero(N))throw new Error("无穷远点");var k=N[0],tt=N[1];l||(l=xe);var ft=Y([A(k),A(tt),T,d]),I=pe(ft,l);if(!o)return{res:!0,content:[y,I]};var Bt=Y([A(k),T,d,A(w),A(g),A(E),A(D)]),lt=Y([A(tt),A(ot.sm3(Bt))]),St=ot.sm3(Y([A(2n),lt])),Pt=ot.sm3(Y([A(3n),lt]));return{res:!0,content:[y,I,St,Pt]}},i.prototype.agreement_confirm=function(s,f,h,o,a,y,l,w){a===void 0&&(a=""),y===void 0&&(y=null),l===void 0&&(l=!1),w===void 0&&(w=null);var g=f.x,x=f.y,m=h.x,T=h.y;if(g=BigInt(g),x=BigInt(x),m=BigInt(m),T=BigInt(T),!this.onCurve([m,T]))throw new Error("不在曲线上");var d=127n,F=1n,E=this.getZ(),D=this.getZ(a,o),q=(1n<<d)+(g&(1n<<d)-1n),_=(BigInt(this.sk)+q*BigInt(s))%this.n,O=(1n<<d)+(m&(1n<<d)-1n),V=F*_,Z=this.Jacb_add(this.Jacb_multiply(O,[BigInt(h.x),BigInt(h.y)],!1),[BigInt(o.x),BigInt(o.y)]),N=this.Jacb_multiply(V,Z),k=N[0],tt=N[1];w||(w=xe);var ft=Y([A(k),A(tt),E,D]),I=pe(ft,w);if(!l&&!y)return{res:!0,content:[I]};var Bt=[A(k),E,D,A(g),A(x),A(m),A(T)],lt=Y([A(tt),A(ot.sm3(Y(Bt)))]);ot.sm3(Y([A(2n),lt]));var St=ot.sm3(Y([A(3n),lt]));return{res:!0,content:[I,St]}},i}(yi);vt.SM2=Si,Object.defineProperty(vt,Symbol.toStringTag,{value:"Module"})});
